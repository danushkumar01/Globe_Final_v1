# Supabase Database Schema

This document outlines the required database tables for the Globe News Monitor application.

## Required Tables

### 1. `countries` table

This table stores country information with sentiment data for the 3D globe visualization.

```sql
CREATE TABLE public.countries (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL,
    lat numeric NOT NULL,
    lon numeric NOT NULL,
    news_count integer DEFAULT 0,
    sentiment text DEFAULT 'neutral',
    updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Add check constraint for sentiment values
ALTER TABLE public.countries 
ADD CONSTRAINT sentiment_check 
CHECK (sentiment IN ('very-positive', 'positive', 'neutral', 'negative', 'very-negative'));

-- Create index for better query performance
CREATE INDEX idx_countries_sentiment ON public.countries(sentiment);
CREATE INDEX idx_countries_updated_at ON public.countries(updated_at);
```

### 2. `news` table

This table stores news articles associated with countries and cities.

```sql
CREATE TABLE public.news (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    country_id bigint REFERENCES public.countries(id) ON DELETE CASCADE,
    city text NOT NULL,
    title text NOT NULL,
    summary text,
    category text DEFAULT 'General',
    severity text DEFAULT 'medium',
    timestamp timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Add check constraint for severity values
ALTER TABLE public.news 
ADD CONSTRAINT severity_check 
CHECK (severity IN ('high', 'medium', 'low'));

-- Add check constraint for category values
ALTER TABLE public.news 
ADD CONSTRAINT category_check 
CHECK (category IN ('Technology', 'Politics', 'Finance', 'Environment', 'Sports', 'Entertainment', 'General'));

-- Create indexes for better query performance
CREATE INDEX idx_news_country_id ON public.news(country_id);
CREATE INDEX idx_news_timestamp ON public.news(timestamp);
CREATE INDEX idx_news_severity ON public.news(severity);
```

### 3. `sentiment_data` table

This table stores sentiment scores and colors for the 2D map visualization.

```sql
CREATE TABLE public.sentiment_data (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    country_name text NOT NULL UNIQUE,
    sentiment_score numeric CHECK (sentiment_score >= 0 AND sentiment_score <= 1),
    color_code text NOT NULL,
    updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Create index for better query performance
CREATE INDEX idx_sentiment_country_name ON public.sentiment_data(country_name);
CREATE INDEX idx_sentiment_updated_at ON public.sentiment_data(updated_at);
```

## Sample Data

### Insert sample countries data:

```sql
INSERT INTO public.countries (name, lat, lon, news_count, sentiment) VALUES
-- Very Positive
('USA', 37.0902, -95.7129, 65, 'very-positive'),
('China', 35.8617, 104.1954, 67, 'very-positive'),
('India', 20.5937, 78.9629, 58, 'very-positive'),
('UK', 55.3781, -3.4360, 52, 'very-positive'),
('Russia', 61.5240, 105.3188, 55, 'very-positive'),

-- Positive
('France', 46.2276, 2.2137, 42, 'positive'),
('Germany', 51.1657, 10.4515, 38, 'positive'),
('Ukraine', 48.3794, 31.1656, 44, 'positive'),
('Japan', 36.2048, 138.2529, 36, 'positive'),
('Brazil', -14.2350, -51.9253, 34, 'positive'),

-- Neutral
('Mexico', 23.6345, -102.5528, 27, 'neutral'),
('Spain', 40.4637, -3.7492, 24, 'neutral'),
('Iran', 32.4279, 53.6880, 26, 'neutral'),
('Egypt', 26.8206, 30.8025, 25, 'neutral'),
('Saudi Arabia', 23.8859, 45.0792, 23, 'neutral'),

-- Negative
('Argentina', -38.4161, -63.6167, 18, 'negative'),
('Colombia', 4.5709, -74.2973, 17, 'negative'),
('Thailand', 15.8700, 100.9925, 16, 'negative'),
('Philippines', 12.8797, 121.7740, 15, 'negative'),
('Lebanon', 33.8547, 35.8623, 14, 'negative'),

-- Very Negative
('Chile', -35.6751, -71.5430, 8, 'very-negative'),
('Peru', -9.1900, -75.0152, 7, 'very-negative'),
('Portugal', 39.3999, -8.2245, 9, 'very-negative'),
('Ireland', 53.4129, -8.2439, 6, 'very-negative'),
('Denmark', 56.2639, 9.5018, 8, 'very-negative');
```

### Insert sample news data:

```sql
-- Get country IDs first
WITH country_ids AS (
  SELECT id, name FROM countries WHERE name IN ('USA', 'UK', 'Japan', 'France', 'Germany')
)

INSERT INTO public.news (country_id, city, title, summary, category, severity, timestamp) 
SELECT 
  c.id,
  city_data.city,
  city_data.title,
  city_data.summary,
  city_data.category,
  city_data.severity,
  city_data.timestamp::timestamp with time zone
FROM country_ids c
CROSS JOIN (
  SELECT * FROM (VALUES
    -- USA
    ('New York', 'Tech Innovation Hub Expands in Manhattan', 'Major tech companies announce new offices in NYC...', 'Technology', 'high', '2025-10-02T10:30:00Z'),
    ('Los Angeles', 'Hollywood Studios Embrace AI Technology', 'Film industry adopts new artificial intelligence tools...', 'Entertainment', 'medium', '2025-10-02T14:20:00Z'),
    ('Chicago', 'Financial District Sees Record Growth', 'Chicago markets reach new heights this quarter...', 'Finance', 'high', '2025-10-02T12:45:00Z')
  ) AS usa_data(city, title, summary, category, severity, timestamp)
  WHERE c.name = 'USA'
  
  UNION ALL
  
  SELECT * FROM (VALUES
    -- UK
    ('London', 'Brexit Trade Agreements Updated', 'New international trade deals announced...', 'Politics', 'high', '2025-10-02T16:00:00Z'),
    ('Manchester', 'Football Championship Finals Set', 'Premier League prepares for exciting season finale...', 'Sports', 'low', '2025-10-02T18:30:00Z')
  ) AS uk_data(city, title, summary, category, severity, timestamp)
  WHERE c.name = 'UK'
  
  UNION ALL
  
  SELECT * FROM (VALUES
    -- Japan
    ('Tokyo', 'Robotics Conference Showcases Future', 'Latest advancements in robotics technology unveiled...', 'Technology', 'high', '2025-10-02T09:00:00Z'),
    ('Osaka', 'Green Energy Initiative Launched', 'New renewable energy project begins in Osaka...', 'Environment', 'medium', '2025-10-02T11:15:00Z')
  ) AS japan_data(city, title, summary, category, severity, timestamp)
  WHERE c.name = 'Japan'
) AS city_data;
```

### Insert sample sentiment data for 2D map:

```sql
INSERT INTO public.sentiment_data (country_name, sentiment_score, color_code) VALUES
-- Very Positive
('United States', 0.85, '#1a5f3d'),
('China', 0.87, '#1a5f3d'),
('India', 0.78, '#1a5f3d'),
('United Kingdom', 0.82, '#1a5f3d'),
('Russia', 0.75, '#1a5f3d'),

-- Positive
('France', 0.72, '#4ade80'),
('Germany', 0.68, '#4ade80'),
('Ukraine', 0.74, '#4ade80'),
('Japan', 0.66, '#4ade80'),
('Brazil', 0.64, '#4ade80'),

-- Neutral
('Mexico', 0.57, '#9ca3af'),
('Spain', 0.54, '#9ca3af'),
('Iran', 0.56, '#9ca3af'),
('Egypt', 0.55, '#9ca3af'),
('Saudi Arabia', 0.53, '#9ca3af'),

-- Negative
('Argentina', 0.38, '#f97316'),
('Colombia', 0.37, '#f97316'),
('Thailand', 0.36, '#f97316'),
('Philippines', 0.35, '#f97316'),
('Lebanon', 0.34, '#f97316'),

-- Very Negative
('Chile', 0.28, '#dc2626'),
('Peru', 0.27, '#dc2626'),
('Portugal', 0.29, '#dc2626'),
('Ireland', 0.26, '#dc2626'),
('Denmark', 0.28, '#dc2626');
```

## Row Level Security (RLS)

Enable RLS for security:

```sql
-- Enable RLS on all tables
ALTER TABLE public.countries ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.news ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.sentiment_data ENABLE ROW LEVEL SECURITY;

-- Create policies for public read access
CREATE POLICY "Allow public read access on countries" ON public.countries
    FOR SELECT USING (true);

CREATE POLICY "Allow public read access on news" ON public.news
    FOR SELECT USING (true);

CREATE POLICY "Allow public read access on sentiment_data" ON public.sentiment_data
    FOR SELECT USING (true);
```

## Real-time Subscriptions

Enable real-time features:

```sql
-- Enable real-time for all tables
ALTER PUBLICATION supabase_realtime ADD TABLE public.countries;
ALTER PUBLICATION supabase_realtime ADD TABLE public.news;
ALTER PUBLICATION supabase_realtime ADD TABLE public.sentiment_data;
```

## Environment Variables

Add these to your `.env.local` file:

```
REACT_APP_SUPABASE_URL=your_project_url
REACT_APP_SUPABASE_ANON_KEY=your_anon_key
```

## Testing the Integration

1. Insert sample data using the SQL above
2. Start the React application: `npm start`
3. Check the browser console for connection status
4. Verify data is loading from Supabase
5. Test real-time updates by modifying data in Supabase dashboard